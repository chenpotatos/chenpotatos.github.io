import{a as e}from"./index.8ba13591.js";import{a,z as s,o,b as i,h as t,e as r,x as l,j as p,k as m,J as c,t as n,C as d,K as b,L as f,l as j,d as u,A as x,B as k}from"./el-select.b78411e2.js";import{a as g}from"./timeFormat.ee22e98c.js";import{E as v}from"./el-upload.bde65488.js";import"./el-progress.7bbcc851.js";import{a as C,E as V}from"./el-checkbox.0618e214.js";/* empty css                          *//* empty css                  *//* empty css                   */import{E as _}from"./el-dialog.64bc625d.js";/* empty css                   *//* empty css                   */import{u as h}from"./main.4e240c16.js";import{c as y}from"./create_login.ce2c2443.js";import{A as w,w as Y}from"./public-api.7aa6cb2f.js";import{SAVE_CONFIG as A}from"./save_config.15a98e40.js";import D from"./hisBackup.f22829e4.js";import{u as E}from"./baseRequest.da51274f.js";import{ElButton as M}from"./index.4a61e9ca.js";import{ElLoading as O}from"./index.622500ea.js";import{ElMessage as R}from"./index.267059ee.js";import"./index.c511a369.js";import"./index.48a3615c.js";import"./isObject.a01dee34.js";import"./style.7be20351.js";import"./index.389214ec.js";import"./error.7e8331f1.js";import"./focus-trap.37f37187.js";import"./aria.66f3f71c.js";import"./typescript.72bf8adc.js";import"./index.d2069d58.js";import"./index.e2562b21.js";import"./index.d0852ddf.js";import"./index.502472ff.js";import"./hasIn.63fdf8ae.js";import"./_arrayPush.949d1e07.js";import"./flatten.a2fc3c9f.js";import"./_baseFlatten.730083dc.js";import"./_overRest.38ce022a.js";import"./identity.737b3aaf.js";import"./icon.e5ddc463.js";import"./index.9a99ea33.js";import"./scroll.64fda821.js";import"./el-form-item.adf4bc32.js";import"./_baseClone.fe51b368.js";import"./_Uint8Array.e97e1f00.js";import"./_initCloneObject.73b0453a.js";import"./el-radio.83523f6e.js";import"./index.c6f50bb1.js";import"./axios.91e25212.js";import"./version.8d34b113.js";import"./d-button.aefa65bf.js";import"./index.c7cdc822.js";import"./index.34bbf0a0.js";/* empty css                        *//* empty css                       */import"./Refresh.3d26c42e.js";import"./index.6ce3651f.js";import"./throttle.0dfde511.js";import"./debounce.abbfdaeb.js";import"./position.9519b900.js";import"./index.b2dab133.js";import"./validator.56de5fb2.js";import"./website.a253acac.js";import"./index.77989186.js";/* empty css                */import"./Close.c8424ab4.js";import"./indexdb.57862a78.js";import"./localforage.60f13183.js";import"./_commonjs-dynamic-modules.30ae7933.js";import"./d-tabs-x.666db9d0.js";import"./config-provider.551e79dd.js";const T=e=>(x("data-v-9e783dd0"),e=e(),k(),e),U=[T((()=>t("a",{class:"link"},"同步到本地",-1)))],z={key:0,class:"setting-li-sub"},F={class:"setting-panel"},J=[T((()=>t("a",{class:"link"},"立即备份",-1)))],B=[T((()=>t("a",{class:"link"},"管理历史备份",-1)))],H=T((()=>t("br",null,null,-1))),I={class:"setting-panel"},N=[T((()=>t("a",{class:"link"},"导出备份数据",-1)))],S=T((()=>t("a",{class:"link"},"导入备份数据",-1))),q={class:"p20 ac"},K={class:"ac mb20"},L=a({__name:"backup",setup(a){const x=E();h();const k=[{label:"设置",value:"baseConfig"},{label:"图标",value:"navConfig"},{label:"备忘录",value:"notes"},{label:"待办",value:"todo"}];function T(){L.backupVisible=!0}const L=s({backupVisible:!1,exportVisible:!1,exportCheck:["baseConfig","navConfig","notes","todo"]});function P(e){if(!function(){let e=j.get("token");return e||(y("login"),R.warning("请登录后使用同步功能")),!!e}())return;const a=O.service({lock:!0,text:"数据同步中",background:"rgba(0, 0, 0, 0.7)"});setTimeout((()=>{a.close()}),500),"backup"==e?A(null,100,"manua"):w()}const G=e=>{var a=new FileReader;a.readAsText(e.raw),a.onload=()=>{const e=JSON.parse(a.result);e?(Y(e),R.success("恢复成功")):R.error("数据格式可能不正确")}},Q=()=>{let a={};L.exportCheck.forEach((e=>{a[e]=j.get(e)||[]})),e(JSON.stringify(a),u().format("-YYYY-MM-DD")+".itabdata")};return(e,a)=>(o(),i("span",null,[t("p",{class:"setting-panel lh24 mb20",onClick:a[0]||(a[0]=e=>P("async"))},U),r(x).itabAsyncTime?(o(),i("h2",z," 上次备份: "+l(r(g)(r(x).itabAsyncTime.baseConfig,"YYYY-MM-DD HH:mm:ss")),1)):p("",!0),t("div",F,[t("p",{onClick:a[1]||(a[1]=e=>P("backup"))},J),t("p",{onClick:T},B)]),H,t("div",I,[t("p",{onClick:a[2]||(a[2]=e=>L.exportVisible=!0)},N),m(r(v),{action:"/","show-file-list":!1,multiple:!1,"auto-upload":!1,"on-change":G,class:"backup-import"},{default:c((()=>[S])),_:1})]),L.backupVisible?(o(),n(D,{key:1,modelValue:L.backupVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>L.backupVisible=e)},null,8,["modelValue"])):p("",!0),m(r(_),{modelValue:L.exportVisible,"onUpdate:modelValue":a[6]||(a[6]=e=>L.exportVisible=e),title:"选择导出内容",width:"600px"},{footer:c((()=>[t("div",K,[m(r(M),{size:"default",onClick:a[5]||(a[5]=e=>L.exportVisible=!1)},{default:c((()=>[d("取消")])),_:1}),m(r(M),{size:"default",class:"ml10",type:"primary",onClick:Q},{default:c((()=>[d("导出")])),_:1})])])),default:c((()=>[t("div",q,[m(r(C),{modelValue:L.exportCheck,"onUpdate:modelValue":a[4]||(a[4]=e=>L.exportCheck=e)},{default:c((()=>[(o(),i(b,null,f(k,(e=>m(r(V),{key:e.value,label:e.value},{default:c((()=>[d(l(e.label),1)])),_:2},1032,["label"]))),64))])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-9e783dd0"]]);export{L as default};
