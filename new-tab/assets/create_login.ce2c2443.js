import{N as e,o as a,t as l,k as o,a as s,b as t,h as n,K as i,L as r,A as d,B as c,i as u,z as p,g as m,J as f,e as g,p as h,C as v,q as b,l as w,c as y,aW as _,Q as x,x as k,m as V,s as T,j as I,aq as C,_ as j,Y as A,aC as q}from"./el-select.b78411e2.js";/* empty css                  */import{E as P}from"./el-dialog.64bc625d.js";/* empty css                   */import{E as z,a as E}from"./el-form-item.adf4bc32.js";import{E as U}from"./el-radio.83523f6e.js";import{a as F}from"./index.c6f50bb1.js";import{u as B,b as D}from"./baseRequest.da51274f.js";import L from"./d-button.aefa65bf.js";import{A as S}from"./public-api.7aa6cb2f.js";import{SAVE_CONFIG as R}from"./save_config.15a98e40.js";import{E as K}from"./index.c7cdc822.js";import{ElButton as M}from"./index.4a61e9ca.js";/* empty css                   */import{d as O}from"./main.4e240c16.js";import{ElMessage as Q}from"./index.267059ee.js";/* empty css                        *//* empty css                       */import{R as H}from"./Refresh.3d26c42e.js";import{ElImage as J}from"./index.6ce3651f.js";import{E as N}from"./index.b2dab133.js";var W=e({name:"Lock"});const Y={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},G=o("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32H224zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96z"},null,-1),X=o("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32zm192-160v-64a192 192 0 1 0-384 0v64h384zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64z"},null,-1);W.render=function(e,o,s,t,n,i){return a(),l("svg",Y,[G,X])},W.__file="packages/components/Lock.vue";const Z=W;var $=e({name:"User"});const ee={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},ae=o("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384zm0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512zm320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0z"},null,-1);$.render=function(e,o,s,t,n,i){return a(),l("svg",ee,[ae])},$.__file="packages/components/User.vue";const le=$,oe="function"==typeof btoa,se="function"==typeof Buffer;"function"==typeof TextDecoder&&new TextDecoder;const te="function"==typeof TextEncoder?new TextEncoder:void 0,ne=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(e=>{let a={};ne.forEach(((e,l)=>a[e]=l))})();const ie=String.fromCharCode.bind(String);"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array);const re=oe?e=>btoa(e):se?e=>Buffer.from(e,"binary").toString("base64"):e=>{let a,l,o,s,t="";const n=e.length%3;for(let i=0;i<e.length;){if((l=e.charCodeAt(i++))>255||(o=e.charCodeAt(i++))>255||(s=e.charCodeAt(i++))>255)throw new TypeError("invalid character found");a=l<<16|o<<8|s,t+=ne[a>>18&63]+ne[a>>12&63]+ne[a>>6&63]+ne[63&a]}return n?t.slice(0,n-3)+"===".substring(n):t},de=se?e=>Buffer.from(e).toString("base64"):e=>{let a=[];for(let l=0,o=e.length;l<o;l+=4096)a.push(ie.apply(null,e.subarray(l,l+4096)));return re(a.join(""))},ce=e=>{if(e.length<2)return(a=e.charCodeAt(0))<128?e:a<2048?ie(192|a>>>6)+ie(128|63&a):ie(224|a>>>12&15)+ie(128|a>>>6&63)+ie(128|63&a);var a=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return ie(240|a>>>18&7)+ie(128|a>>>12&63)+ie(128|a>>>6&63)+ie(128|63&a)},ue=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,pe=se?e=>Buffer.from(e,"utf8").toString("base64"):te?e=>de(te.encode(e)):e=>re(e.replace(ue,ce)),me=(e,a=!1)=>a?(e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")))(pe(e)):pe(e),fe={class:"d-flex-between login-third mt15"},ge=(e=>(d("data-v-e3372ab4"),e=e(),c(),e))((()=>n("div",null,"第三方账号登录",-1))),he={class:"d-flex"},ve=["href","onClick"],be=["src"],we=s({__name:"loginThird",emits:["loginThird"],setup(e,{emit:l}){const o=[{url:"https://api.weibo.com/oauth2/authorize?client_id=3805380913&redirect_uri=https://www.codelife.cc/logincb&response_type=code&state=&scope=all",icon:"weibo"},{url:"https://graph.qq.com/oauth2.0/show?which=Login&display=pc&response_type=code&client_id=101983660&redirect_uri=https%3A%2F%2Fwww.codelife.cc%2Flogincb&state=qq",icon:"qq"},{url:"https://github.com/login/oauth/authorize?client_id=930860aee1b7c1ce56ee&scope=user",icon:"github"}];return(e,s)=>(a(),t("div",fe,[ge,n("div",he,[(a(),t(i,null,r(o,(e=>n("span",{href:e.url,key:e.icon,onClick:a=>(e=>{window.open(e.url,"_blank","width=800,height=500"),window.addEventListener("message",(e=>{let a=e.data||{};l("loginThird",a)}),!1)})(e)},[n("img",{style:{width:"24px",height:"24px"},src:`./login/${e.icon}.svg`},null,8,be)],8,ve))),64))])]))}},[["__scopeId","data-v-e3372ab4"]]),ye=e=>(d("data-v-4b99d000"),e=e(),c(),e),_e=[ye((()=>n("span",{class:"brid-body"},null,-1))),ye((()=>n("span",{class:"brid-claw left"},null,-1))),ye((()=>n("span",{class:"brid-claw right"},null,-1)))],xe=s({__name:"noPassword",props:{inputPass:{type:Boolean,defautl:!1}},setup(e){const l=e;return(e,o)=>(a(),t("div",null,[n("div",{class:u(["login-bird",{password:l.inputPass}])},_e,2)]))}},[["__scopeId","data-v-4b99d000"]]),ke=e=>(d("data-v-e8e57ad9"),e=e(),c(),e),Ve=ke((()=>n("div",{class:"ar",style:{margin:"-15px 0 10px 0"}},[n("a",{class:"d-main f12",target:"_blank",href:"https://codelife.cc/account/pass?type=find"},"忘记密码")],-1))),Te=ke((()=>n("div",null,[n("h2",{class:"ac f18 mb10 pt30"},"选择账号数据")],-1))),Ie=ke((()=>n("p",{class:"f12 d-sub ac"}," 检测到云端数据和本地数据不一致，请选择使用其中某一项数据 ",-1))),Ce={style:{padding:"20px 40px 40px"}},je={class:"ac mt30"},Ae=s({__name:"login",emits:["close"],setup(e,{expose:l,emit:s}){const i=B(),r=p({email:"",password:""}),d=p({loading:!1,userInfo:{},selectDataVisible:!1,dataActive:2,isInputPass:!1}),c=m(null),u=()=>{d.loading=!0;let e={};e.email=r.email,e.from="itab",e.password=me(r.password),e.t=(new Date).getTime(),F.userLogin(e).then((e=>{200==e.code&&y(e)})).finally((()=>{d.loading=!1}))};function y(e){if(d.userInfo=e.data||{},!e.token)return;d.userInfo.token=e.token;let a=!1;d.userInfo.upTime&&(a=!0);for(let l in d.userInfo.itabAsyncTime)1!=d.userInfo.itabAsyncTime[l]&&(a=!0);a?d.selectDataVisible=!0:(i.value=d.userInfo,w.set("token",d.userInfo.token),s("close"))}function _(){i.value=d.userInfo,w.set("token",d.userInfo.token),2==d.dataActive?S(null,d.userInfo.itabAsyncTime):R(null,!0),d.selectDataVisible=!1,s("close")}return l({loginSuccess:y}),(e,l)=>(a(),t("div",null,[o(xe,{inputPass:d.isInputPass},null,8,["inputPass"]),o(g(E),{onSubmit:l[4]||(l[4]=b((()=>{}),["prevent"])),size:"large",model:r,ref_key:"refLoginForm",ref:c,"label-position":"right"},{default:f((()=>[o(g(z),{prop:"email",rules:{required:!0,type:"email",message:"邮箱格式不正确"}},{default:f((()=>[o(g(K),{"prefix-icon":g(le),maxlength:"40",modelValue:r.email,"onUpdate:modelValue":l[0]||(l[0]=e=>r.email=e),placeholder:"请输入邮箱"},null,8,["prefix-icon","modelValue"])])),_:1}),o(g(z),{prop:"password",rules:{required:!0,message:"密码不能为空"}},{default:f((()=>[o(g(K),{onKeydown:h(u,["enter"]),maxlength:"20","show-password":"","prefix-icon":g(Z),type:"password",modelValue:r.password,"onUpdate:modelValue":l[1]||(l[1]=e=>r.password=e),onFocus:l[2]||(l[2]=e=>d.isInputPass=!0),onBlur:l[3]||(l[3]=e=>d.isInputPass=!1),placeholder:"请输入6-18位密码"},null,8,["onKeydown","prefix-icon","modelValue"])])),_:1}),Ve,o(L,{round:"",size:"large",onClick:u,type:"primary",class:"wfull",loading:d.loading},{default:f((()=>[v("立即登录")])),_:1},8,["loading"])])),_:1},8,["model"]),o(g(P),{"append-to-body":!0,width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,modelValue:d.selectDataVisible,"onUpdate:modelValue":l[7]||(l[7]=e=>d.selectDataVisible=e)},{default:f((()=>[Te,Ie,n("div",Ce,[n("p",null,[o(g(U),{modelValue:d.dataActive,"onUpdate:modelValue":l[5]||(l[5]=e=>d.dataActive=e),label:1},{default:f((()=>[v("使用本地数据")])),_:1},8,["modelValue"])]),n("p",null,[o(g(U),{modelValue:d.dataActive,"onUpdate:modelValue":l[6]||(l[6]=e=>d.dataActive=e),label:2},{default:f((()=>[v("使用云端数据")])),_:1},8,["modelValue"])]),n("p",je,[o(g(M),{onClick:_,class:"wfull",type:"primary"},{default:f((()=>[v("确定")])),_:1})])])])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-e8e57ad9"]]),qe={class:"d-flex-between wfull"},Pe={__name:"register",emits:["close"],setup(e,{emit:l}){const s=B(),i=p({timer:null,loading:!1,timerText:"获取验证码",setp:0,isInputPass:!1}),r=p({email:"",username:"",password:"",verifyKey:"",source:O()}),d=m(null);const c=y((()=>!_(r.email)));y((()=>!_(r.email)));const u=()=>{_(r.email)?(i.timerText=10,i.timer=setInterval((()=>{i.timerText--,i.timerText<=0&&(clearInterval(i.timer),i.timerText="获取验证码")}),1e3),F.userSendVerifyCode({email:r.email}).then((e=>{Q.success("验证码发送成功")}))):Q.warning("请输入正确的邮箱")};function h(){d.value.validate((e=>{if(!e)return;i.loading=!0;let a={...r,password:me(r.password)};a.t=(new Date).getTime(),F.userRegistry(a).then((e=>{let a=e.data||{};s.value=a,w.set("token",e.token),Q.success("注册成功"),l("close")})).finally((()=>{i.loading=!1}))}))}return x((()=>{clearInterval(i.timer)})),(e,l)=>(a(),t("div",null,[o(xe,{inputPass:i.isInputPass},null,8,["inputPass"]),o(g(E),{onSubmit:l[6]||(l[6]=b((()=>{}),["prevent"])),size:"default",model:r,ref_key:"refLoginForm",ref:d,"label-position":"right"},{default:f((()=>[o(g(z),{prop:"email",rules:{required:!0,type:"email",message:"邮箱格式不正确"}},{default:f((()=>[n("div",qe,[o(g(K),{autocomplete:"off",maxlength:"40",modelValue:r.email,"onUpdate:modelValue":l[0]||(l[0]=e=>r.email=e),modelModifiers:{trim:!0},placeholder:"请输入邮箱"},null,8,["modelValue"]),o(g(M),{style:{width:"90px"},type:"primary",class:"ml5",disabled:g(c)||"获取验证码"!=i.timerText,onClick:u},{default:f((()=>[v(k(i.timerText),1)])),_:1},8,["disabled"])])])),_:1}),o(g(z),{prop:"verifyKey",rules:{required:!0,message:"验证码不能为空"}},{default:f((()=>[o(g(K),{autocomplete:"off",maxlength:"6",modelValue:r.verifyKey,"onUpdate:modelValue":l[1]||(l[1]=e=>r.verifyKey=e),placeholder:"请输入6位邮箱验证码"},null,8,["modelValue"])])),_:1}),o(g(z),{prop:"username",rules:{required:!0,message:"请输入用户名"}},{default:f((()=>[o(g(K),{autocomplete:"off",maxlength:"18",modelValue:r.username,"onUpdate:modelValue":l[2]||(l[2]=e=>r.username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),o(g(z),{prop:"password",rules:{required:!0,message:"密码不能为空"}},{default:f((()=>[o(g(K),{autocomplete:"off",maxlength:"20","show-password":"",type:"password",onFocus:l[3]||(l[3]=e=>i.isInputPass=!0),onBlur:l[4]||(l[4]=e=>i.isInputPass=!1),modelValue:r.password,"onUpdate:modelValue":l[5]||(l[5]=e=>r.password=e),placeholder:"请输入8-18密码"},null,8,["modelValue"])])),_:1}),o(L,{size:"large",round:"",loading:i.loading,onClick:h,type:"primary",class:"wfull"},{default:f((()=>[v("立即注册 ")])),_:1},8,["loading"])])),_:1},8,["model"])]))}},ze=""+new URL("../login/wechat.svg",import.meta.url).href,Ee=e=>(d("data-v-beb9c8b7"),e=e(),c(),e),Ue={class:"login-wechat ac"},Fe=Ee((()=>n("img",{class:"wechat-logo",src:ze},null,-1))),Be=Ee((()=>n("p",null,"微信登录",-1))),De={class:"wechat-qrcode"},Le=Ee((()=>n("p",{class:"ac mb20"},[v(" 打开微信 "),n("b",{calss:"b"},"扫一扫"),v("， "),n("b",{calss:"b"},"关注公众号"),v("后即可登录/注册 ")],-1))),Se=Ee((()=>n("p",{class:"ac mt20 f16"},[n("b",null,"绑定邮箱")],-1))),Re={class:"login-tabs d-flex ac mb10"},Ke=["onClick"],Me={class:"ar",style:{margin:"-15px 0 10px 0"}},Oe={key:0,class:"d-main f12",target:"_blank",href:"https://codelife.cc/account/pass?type=find"},Qe={name:"wechat-login"},He=s(Object.assign(Qe,{emits:["loginThird"],setup(e,{emit:l}){const s=m([{name:"绑定老用户",key:"old"},{name:"绑定新用户",key:"new"}]),d=p({loading:!1,isQRcodeExpire:!1}),c=p({img:"",ticket:""}),w=m(!1),y=p({email:"",password:"",wechatOpenid:"",userType:"old"});let _=null,C=0;function j(){_&&clearInterval(_),d.isQRcodeExpire=!1,_=setInterval((()=>{c.ticket&&(C+=2,C>60&&(clearInterval(_),C=0,d.isQRcodeExpire=!0),((e={})=>D.get("/user/wechatLogin/info",{params:e}))({ticket:c.ticket}).then((e=>{e.data.success&&(clearInterval(_),e.token?l("loginThird",e):(y.wechatOpenid=e.data.wechat_openid,N.confirm("是否绑定邮箱?",{confirmButtonText:"是的",cancelButtonText:"不绑定",center:!0}).then((()=>{w.value=!0})).catch((()=>{A("skip")}))))})))}),2e3),D.get("/user/wechat/qrcode").then((e=>{let a=e.data||{};c.img=a.img,c.ticket=a.ticket}))}j(),x((()=>{_&&clearInterval(_)}));const A=e=>{d.loading=!0;let a={...y};a.from="wechat","skip"==e?(a.email="",a.userType="skip",a.password=""):a.password=me(y.password),((e={})=>D.post("/user/wechatBindEmail",e))(a).then((e=>{200==e.code&&l("loginThird",e)})).finally((()=>{d.loading=!1}))};return(e,l)=>(a(),t("div",Ue,[V(n("span",null,[Fe,Be,n("div",De,[V(n("span",{onClick:l[0]||(l[0]=e=>j()),class:"wechat-qrcode-refresh d-icon"},[o(g(H))],512),[[T,d.isQRcodeExpire]]),o(g(J),{class:"wechat-ticket",alt:"加载二维码",src:c.img},null,8,["src"])]),Le],512),[[T,!w.value]]),V(n("span",null,[Se,n("ul",Re,[(a(!0),t(i,null,r(s.value,(e=>(a(),t("li",{class:u(["d-cell",{active:y.userType===e.key}]),key:e.key,onClick:a=>y.userType=e.key},k(e.name),11,Ke)))),128))]),o(g(E),{onSubmit:l[3]||(l[3]=b((()=>{}),["prevent"])),size:"large",model:y,ref:"refLoginForm","label-position":"right"},{default:f((()=>[o(g(z),{prop:"email",rules:{required:!0,type:"email",message:"邮箱格式不正确"}},{default:f((()=>[o(g(K),{"prefix-icon":g(le),maxlength:"40",modelValue:y.email,"onUpdate:modelValue":l[1]||(l[1]=e=>y.email=e),placeholder:"请输入邮箱"},null,8,["prefix-icon","modelValue"])])),_:1}),o(g(z),{prop:"password",rules:{required:!0,message:"密码不能为空"}},{default:f((()=>[o(g(K),{onKeydown:h(A,["enter"]),maxlength:"20","show-password":"","prefix-icon":g(Z),type:"password",modelValue:y.password,"onUpdate:modelValue":l[2]||(l[2]=e=>y.password=e),placeholder:"请输入6-18位密码"},null,8,["onKeydown","prefix-icon","modelValue"])])),_:1}),n("div",Me,["old"==y.userType?(a(),t("a",Oe,"忘记密码")):I("",!0)]),o(g(M),{round:"",onClick:A,type:"primary",class:"mt10 mb20 wfull",loading:d.loading},{default:f((()=>[v("立即登录")])),_:1},8,["loading"])])),_:1},8,["model"])],512),[[T,w.value]])]))}}),[["__scopeId","data-v-beb9c8b7"]]),Je={class:"app-login hfull"},Ne={class:"login-tabs d-flex b ac mb10"},We=["onClick"],Ye={class:"login-tip ac"},Ge={key:0,class:"mt5"},Xe={class:"pl30 pr30 mb30"},Ze={class:"ac mt5"},$e=s({__name:"index",props:{type:String},setup(e){const s=e,d=C(),c=m(s.type),p=m(null),h=m([{name:"扫码登录",key:"scan"},{name:"其他方式登录",key:"other"}]),b=m("scan");const w=e=>{p.value.loginSuccess(e)};function y(){d.onClose()}return(e,s)=>(a(),l(g(P),{top:"10vh",class:"login-dialog","close-on-press-escape":!1,"close-on-click-modal":!1,width:"420px"},{default:f((()=>[n("div",Je,[n("ul",Ne,[(a(!0),t(i,null,r(h.value,(e=>(a(),t("li",{class:u(["d-cell",{active:b.value===e.key}]),key:e.key,onClick:a=>b.value=e.key},k(e.name),11,We)))),128))]),V(o(He,{onLoginThird:w},null,512),[[T,"scan"==b.value]]),V(n("span",null,[n("div",Ye,["firefox"==g(O)()?(a(),t("p",Ge,"火狐暂不支持第三方登录")):I("",!0)]),n("div",Xe,[V(o(Ae,{ref_key:"loginRef",ref:p,onClose:y},null,512),[[T,"login"==c.value]]),V(o(Pe,{onClose:y},null,512),[[T,"reg"==c.value]]),o(we,{onLoginThird:w}),n("div",Ze,[v(k("login"==c.value?"还没有账号":" 已有账号？")+" ",1),o(g(M),{text:"",onClick:s[0]||(s[0]=e=>{return a="reg"==c.value?"login":"reg",void(c.value=a);var a})},{default:f((()=>[v("立即"+k("login"==c.value?"注册":"登录"),1)])),_:1})])])],512),[[T,"other"==b.value]])])])),_:1}))}},[["__scopeId","data-v-610ef2d5"]]),ea=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"})),aa=e=>{j((()=>Promise.resolve().then((()=>ea))),void 0,import.meta.url).then((a=>{const l=A($e,{modelValue:!0,type:e,onClose:()=>{setTimeout((()=>{q(null,document.body)}),300)}});q(l,document.body)}))};export{aa as c};
