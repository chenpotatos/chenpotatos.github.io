import{G as e,u as t,a1 as a,Z as i,$ as s,l as n,az as o,_ as l,d as g,aA as c}from"./el-select.b78411e2.js";import{a as r}from"./index.c6f50bb1.js";import{d as f}from"./website.a253acac.js";import{d}from"./index.77989186.js";import u from"./indexdb.57862a78.js";import{u as m}from"./baseRequest.da51274f.js";const b=e(),v=t(),y=a(),h=i(),p=s(),w=[{key:"baidu",title:"百度",href:"https://www.baidu.com/s?&tn=68018901_2_oem_dgie=utf-8&wd="},{key:"google",title:"Google",href:"https://www.google.com/search?q="},{key:"bing",title:"必应",href:"https://www.bing.com/search?q="},{key:"github",title:"gitHub",href:"https://github.com/search?q="}];!y.value&&(y.value=[]),!h.value&&(h.value=[]);const C=e=>{var t,a,i;e.baseConfig&&(e.baseConfig.searchEngine||(e.baseConfig.searchEngine=w),e.baseConfig.open||(e.baseConfig.open={searchBlank:null==(a=null==(t=e.baseConfig)?void 0:t.search)?void 0:a.blank,iconBlank:null==(i=v.value.search)?void 0:i.blank}),v.value=e.baseConfig),e.navConfig&&(b.value=e.navConfig),e.todo&&(u.set("todo",e.todo),y.value=e.notes.slice(0,3)),e.notes&&(u.set("notes",e.notes),h.value=e.notes.slice(0,3),o.value=e.notes.filter((e=>e&&e.fixed))),e.stocks&&(p.value=e.stocks),localStorage.setItem("dataCleansing","null")};window.addEventListener("storage",(t=>{if("navConfig"===t.key){let t=n.get("navConfig")||[];t.length&&(b.value=t,e().value=t)}}));const _=(e,t)=>{n.get("token")&&(n.set("asyncTime",t),e||(e={baseConfig:1,navConfig:1,notes:1,todo:1}),d("同步中","loading"),r.itabConfig(e).then((e=>{d("同步成功","check");let t=e.data;t&&t.iTabConfig&&(t=JSON.parse(t.iTabConfig)),t&&C(t)})))},T=m(),k=async()=>{let e=await l((()=>import("./indexdb.57862a78.js")),["./indexdb.57862a78.js","./localforage.60f13183.js","./el-select.b78411e2.js","./el-select.b0658523.css","./_commonjs-dynamic-modules.30ae7933.js"],import.meta.url);e=e.default;let t=await e.get("todayBing"),a=g().format("YYYYMMDD");if(t&&t.enddate==a)return t;let i=await r.getBing(),s=i.data||{};return e.set("todayBing",i.data||{}),n.set("todayBing",{thumb:s.thumb,copyright:s.copyright}),s||{}};async function A(e,t){for(let a=0;a<e.length;a++)await t(e[a],a,e)}const j=async(e,t)=>{let a=await l((()=>import("./indexdb.57862a78.js")),["./indexdb.57862a78.js","./localforage.60f13183.js","./el-select.b78411e2.js","./el-select.b0658523.css","./_commonjs-dynamic-modules.30ae7933.js"],import.meta.url);if(a=a.default,a.get("configHistory").then((async t=>{let i=t||[];if("navConfig"===e||!e){let e=["baseConfig","navConfig","notes","todo","stocks"],t={};await A(e,(async e=>{if(["notes","todo"].includes(e)){let i=await a.get(e)||n.get(e)||[];t[e]=i}else t[e]=n.get(e)})),i.unshift({data:t||[],ct:g().valueOf()}),a.set("configHistory",i.slice(0,10))}})),!n.get("token"))return;let i=["baseConfig","navConfig","notes","todo","stocks"],s={},o={saveType:t},c=T.value.itabAsyncTime||{};if(e){let t=g().valueOf();if(["notes","todo"].includes(e)){let t=await a.get(e)||n.get(e)||[];o[e]=t}else o[e]=n.get(e);c[e]=t,s[`itabAsyncTime.${e}`]=t}else{let e=g().valueOf();await A(i,(async t=>{c[t]=e;if(["notes","todo"].includes(t)){let e=await a.get(t)||n.get(t)||[];o[t]=e}else o[t]=n.get(t);s[`itabAsyncTime.${t}`]=e}))}d("备份中...","loading"),r.itabConfigUpdate(o).then((()=>{r.userUpdate(s),n.set("asyncTime",c),setTimeout((()=>{d("备份成功","check")}),260),T.value.itabAsyncTime=c})).catch((()=>{d("备份失败","close"),l((()=>import("./index.267059ee.js")),["./index.267059ee.js","./el-select.b78411e2.js","./el-select.b0658523.css","./config-provider.551e79dd.js","./index.c511a369.js","./index.48a3615c.js","./isObject.a01dee34.js","./style.7be20351.js","./index.e2562b21.js","./typescript.72bf8adc.js","./icon.e5ddc463.js","./index.389214ec.js","./aria.66f3f71c.js","./index.9a99ea33.js"],import.meta.url).then((e=>{e.ElMessage({type:"error",message:"备份失败，稍后请手动尝试",duration:0,showClose:!0})}))}))},E=Object.freeze(Object.defineProperty({__proto__:null,getTodayBing:k,getUserInfo:()=>{n.get("token")?r.userInfo({from:"itab",t:(new Date).getTime()}).then((e=>{T.value=e.data||{};let t=n.get("asyncTime"),a={};for(let i in e.data.itabAsyncTime)t[i]!=e.data.itabAsyncTime[i]&&(a[i]=1);c(a)||_(a,e.data.itabAsyncTime)})):T.value={}},saveConfig:j,asyncConfig:async e=>{if(!T.value._id)return{};if(n.get("asyncTime")[e]==T.value.itabAsyncTime[e])return{};d("同步中","loading");let t={};t[e]=1;let a=await r.itabConfig(t);return d("同步成功","check"),a},delIcon:async e=>{if(e&&e.includes("user_")){let t=[e.replace("https://files.codelife.cc/","")];f({paths:t})}}},Symbol.toStringTag,{value:"Module"}));export{_ as A,k as g,E as p,j as s,C as w};
